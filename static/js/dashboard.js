json = { "general": { "total_number_of_beneficiaries_referred": 30, "total_number_of_effective_referrals": 29, "total_number_of_rewardable_referrals": 0, "total_number_of_orders_from_referrals": 29, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "daily": { "2022-05-30": { "total_number_of_beneficiaries_referred": 2, "total_number_of_orders_from_referrals": 2, "total_number_of_effective_referrals": 4, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-05-18": { "total_number_of_beneficiaries_referred": 3, "total_number_of_orders_from_referrals": 2, "total_number_of_effective_referrals": 2, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-05-13": { "total_number_of_beneficiaries_referred": 1, "total_number_of_orders_from_referrals": 0, "total_number_of_effective_referrals": 0, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-05-17": { "total_number_of_beneficiaries_referred": 3, "total_number_of_orders_from_referrals": 3, "total_number_of_effective_referrals": 3, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-06-07": { "total_number_of_beneficiaries_referred": 5, "total_number_of_orders_from_referrals": 3, "total_number_of_effective_referrals": 3, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-05-28": { "total_number_of_beneficiaries_referred": 1, "total_number_of_orders_from_referrals": 1, "total_number_of_effective_referrals": 1, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-05-24": { "total_number_of_beneficiaries_referred": 2, "total_number_of_orders_from_referrals": 1, "total_number_of_effective_referrals": 1, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-06-01": { "total_number_of_beneficiaries_referred": 1, "total_number_of_orders_from_referrals": 3, "total_number_of_effective_referrals": 3, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-06-06": { "total_number_of_beneficiaries_referred": 3, "total_number_of_orders_from_referrals": 6, "total_number_of_effective_referrals": 4, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-05-25": { "total_number_of_beneficiaries_referred": 5, "total_number_of_orders_from_referrals": 5, "total_number_of_effective_referrals": 5, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-05-31": { "total_number_of_beneficiaries_referred": 1, "total_number_of_orders_from_referrals": 1, "total_number_of_effective_referrals": 1, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2022-05-23": { "total_number_of_beneficiaries_referred": 3, "total_number_of_orders_from_referrals": 2, "total_number_of_effective_referrals": 2, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 } }, "weekdays": { "0": { "total_number_of_beneficiaries_referred": 8, "total_number_of_orders_from_referrals": 10, "total_number_of_effective_referrals": 10, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "1": { "total_number_of_beneficiaries_referred": 11, "total_number_of_orders_from_referrals": 8, "total_number_of_effective_referrals": 8, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "2": { "total_number_of_beneficiaries_referred": 9, "total_number_of_orders_from_referrals": 10, "total_number_of_effective_referrals": 10, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "3": { "total_number_of_beneficiaries_referred": 0, "total_number_of_orders_from_referrals": 0, "total_number_of_effective_referrals": 0, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "4": { "total_number_of_beneficiaries_referred": 1, "total_number_of_orders_from_referrals": 0, "total_number_of_effective_referrals": 0, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "5": { "total_number_of_beneficiaries_referred": 1, "total_number_of_orders_from_referrals": 1, "total_number_of_effective_referrals": 1, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 }, "6": { "total_number_of_beneficiaries_referred": 0, "total_number_of_orders_from_referrals": 0, "total_number_of_effective_referrals": 0, "total_number_of_rewardable_referrals": 0, "total_number_of_referral_rewards": 0, "cost_of_total_number_of_rewards": 0 } } }

function getDates(number=6, duration="month", date=new Date()) {
    // gets <number> dates with duration difference from date
    // e.g. number-6, duration='month' will get 6 dates that are 1 month apart from each other starting with date
    // the values for duration are hour, day, month, year; a month is considered as 30 days and a year 365

    let millisecondConversionRate = null;

    switch(duration) {
        case "month":
            millisecondConversionRate = 30 * 24 * 60 * 60 * 1000
            break;
        default:
            millisecondConversionRate = 30 * 24 * 60 * 60 * 1000
            break;
    }

    let dates = [date];

    for (let i=1; i<=number; i++) {
        let newDate = new Date(date.getTime() - ( millisecondConversionRate * i ))
        dates.push(newDate)
    }

    return dates;
}

const ctx = document.getElementById("chart").getContext("2d");

$("#beneficiary-stats .num").text(json["general"]["total_number_of_beneficiaries_referred"])
$("#earnings-stat .num").text(json["general"]["cost_of_total_number_of_rewards"])

const actions = [
    {
      name: 'pointStyle: circle (default)',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'cirlce';
        });
        chart.update();
      }
    },
    {
      name: 'pointStyle: cross',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'cross';
        });
        chart.update();
      }
    },
    {
      name: 'pointStyle: crossRot',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'crossRot';
        });
        chart.update();
      }
    },
    {
      name: 'pointStyle: dash',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'dash';
        });
        chart.update();
      }
    },
    {
      name: 'pointStyle: line',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'line';
        });
        chart.update();
      }
    },
    {
      name: 'pointStyle: rect',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'rect';
        });
        chart.update();
      }
    },
    {
      name: 'pointStyle: rectRounded',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'rectRounded';
        });
        chart.update();
      }
    },
    {
      name: 'pointStyle: rectRot',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'rectRot';
        });
        chart.update();
      }
    },
    {
      name: 'pointStyle: star',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'star';
        });
        chart.update();
      }
    },
    {
      name: 'pointStyle: triangle',
      handler: (chart) => {
        chart.data.datasets.forEach(dataset => {
          dataset.pointStyle = 'triangle';
        });
        chart.update();
      }
    }
];

let dates = getDates();
dates = dates.reverse();

let datasetLabels = ["Number of referrals", "Number of effective referrals", "Number of rewardable referrals"]
let datasetBorderColors = ["red", "#3ca877", "#f88c00"];

let labels = [], datasets = [];

for (let date of dates) {
    labels.push( `${ months[date.getMonth()] } ${ date.getFullYear() }` )
}

for (let labelIndex=0; labelIndex<datasetLabels.length; labelIndex++) {
    let label = datasetLabels[labelIndex];

    let data = [];
    for (let i=0; i<dates.length; i++) {
        data.push(0.0);
    }

    let datasetObject = {
        label: label,
        data: data,
        borderColor: datasetBorderColors[labelIndex],
        pointStyle: 'circle',
        pointRadius: 5,
        pointHoverRadius: 10
    }

    datasets.push(datasetObject)
}

const data = {
    labels: labels,
    datasets: datasets
}

for (let dateString in json["daily"]) {
    let date = new Date(dateString);
    let item = json["daily"][dateString];

    let monthAndYear = `${months[date.getMonth()]} ${date.getFullYear()}`
    let index = labels.indexOf(monthAndYear)

    if (index >= 0) {
        data.datasets[0].data[index] += item["total_number_of_beneficiaries_referred"]
        data.datasets[1].data[index] += item["total_number_of_effective_referrals"]
        data.datasets[2].data[index] += item["total_number_of_rewardable_referrals"]
    } else {
        console.log("Date not found in predefined range")
        console.log(item)
    }
}

const config = {
    type: 'line',
    data: data,
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: (ctx) => 'Point Style: ' + ctx.chart.data.datasets[0].pointStyle,
            }
        }
    }
}

const myChart = new Chart(ctx, config)